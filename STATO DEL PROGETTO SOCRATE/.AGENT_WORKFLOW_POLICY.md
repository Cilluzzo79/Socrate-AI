# Agent Workflow Policy

**Data Creazione**: 20 Ottobre 2025, ore 03:30
**Ultimo Aggiornamento**: 21 Ottobre 2025, ore 22:00
**Richiesta Utente**: "Coinvolgete sempre gli agenti specializzati per le loro discipline"

## Policy Obbligatoria

Per OGNI decisione tecnica significativa, devo SEMPRE consultare gli agenti specializzati appropriati in base al dominio:

---

## Agenti Specializzati

### 1. Backend Master Analyst (@agent-backend-master-analyst)

**Specializzazione**: Backend code quality, security, performance

**Quando invocare** (OBBLIGATORIO):
- Implementazione o modifica di endpoint API
- Modifiche a database queries o ORM
- Refactoring di logica business
- Fix di bug backend (Python/Flask/Celery)
- Code review di modifiche server-side
- Analisi performance e memory management
- Security review
- Async task processing (Celery/Redis)

**Output atteso**: Code review dettagliato con:
- ✅ Codice corretto
- ⚠️ Warning/miglioramenti
- ❌ Bug critici
- 💡 Raccomandazioni
- **Rating**: X/10 con breakdown

**Esempio Invocazione**:
```markdown
## Contesto Backend
Ho implementato endpoint /api/documents/upload-batch con OCR parallelo

## Codice Modificato
[api_server.py linee 578-627]

## Domande
1. Memory leak risk con ThreadPoolExecutor?
2. Error handling robusto per OCR failures?
3. Railway deployment concerns?

## Output Richiesto
- Code review con rating
- Security assessment
- Production readiness check
```

---

### 2. General-Purpose Agent (@agent-general-purpose)

**Specializzazione**: Strategic decision-making, architecture planning

**Quando invocare** (OBBLIGATORIO):
- Decisioni strategiche su approccio implementazione
- Valutazione trade-off (refactoring vs fix incrementale)
- Analisi root cause di problemi complessi
- Review workflow e process
- Planning deployment strategy
- Prioritizzazione fix
- Risk assessment
- Long-term roadmap planning

**Output atteso**: Strategic assessment con:
- Valutazione approccio
- Lessons learned
- Raccomandazioni actionable
- Risk analysis
- Timeline recommendations

**Esempio Invocazione**:
```markdown
## Contesto Strategico
Devo scegliere tra FIX 11 (pdf2image+OCR) e Alternative A (OCR Pre-PDF)

## Opzioni
- FIX 11: Quick win ma technical debt
- Alt A: 2 ore in più ma zero debt

## Domande
1. Quale approccio scegliere?
2. Trade-off lifetime cost?
3. Railway deployment feasibility?

## Output Richiesto
- Strategic recommendation
- Risk analysis
- Deployment plan
```

---

### 3. Frontend Architect Prime (@agent-frontend-architect-prime) ⭐ NUOVO

**Specializzazione**: React/TypeScript, frontend architecture, performance optimization

**Quando invocare** (OBBLIGATORIO):
- Implementazione o modifica di componenti React/frontend
- Refactoring di codice JavaScript/TypeScript
- Ottimizzazione performance frontend (Core Web Vitals)
- Implementazione state management (hooks, Context API)
- Fix di bug frontend (rendering, event handling)
- Code review di modifiche client-side
- Implementazione UI components con accessibilità
- Integrazione API frontend-backend

**Output atteso**: Frontend code review con:
- ✅ Codice corretto (TypeScript safety, React best practices)
- ⚠️ Performance optimizations
- ❌ Bug critici
- ♿ Accessibility issues (WCAG compliance)
- 💡 Raccomandazioni architetturali
- **Rating**: X/10 con breakdown

**Esempio Invocazione**:
```markdown
## Contesto Frontend
Ho implementato gallery picker con limite 10 foto in dashboard.js

## Codice Modificato
[static/js/dashboard.js uploadBatch() function]

## Domande
1. Event handling corretto per gallery input?
2. Memory leaks con Blob URLs?
3. Accessibilità della validazione limite foto?
4. Performance con 10 foto parallele?

## Output Richiesto
- Code review con rating
- Performance analysis
- Accessibility check
- Best practices recommendations
```

---

### 4. UI Design Master (@agent-ui-design-master) ⭐ NUOVO

**Specializzazione**: UI/UX design, user experience, design systems

**Quando invocare** (OBBLIGATORIO):
- Design o redesign di interfacce utente
- Analisi UX di flussi utente (user journeys)
- Ottimizzazione user onboarding
- Valutazione accessibilità (WCAG 2.1 AA/AAA)
- Design system e component library
- Error states e feedback utente
- Responsive design e mobile-first
- Conversion optimization

**Output atteso**: UX assessment con:
- 🎨 Design recommendations
- 👤 User journey analysis
- ♿ Accessibility compliance
- 📱 Responsive design issues
- 💡 UX improvements
- **Rating**: X/10 per user experience

**Esempio Invocazione**:
```markdown
## Contesto UX
Implementato limite 10 foto con alert() per errore

## UI Attuale
```javascript
if (capturedImages.length > 10) {
    alert('Puoi caricare massimo 10 foto...');
}
```

## Domande
1. Alert() è UX acceptable o serve toast notification?
2. Come comunicare limite PRIMA che utente selezioni foto?
3. Error message chiaro per utente non tecnico?
4. Accessibilità per screen readers?

## Output Richiesto
- UX assessment con rating
- Alternative design recommendations
- Accessibility review
- Best practices for error communication
```

---

## Workflow Standard

### 🔹 Prima di Implementare (Planning Phase)

**Scenario**: Backend API + Frontend UI changes

1. 🎯 **Identifico il problema** e dominio coinvolto
2. 📊 **Raccolgo dati e contesto**
3. 🤖 **INVOCO AGENTI IN PARALLELO** (tutti rilevanti):
   - **Backend changes** → `backend-master-analyst` + `general-purpose`
   - **Frontend changes** → `frontend-architect-prime` + `ui-design-master`
   - **Full-stack changes** → **TUTTI E 4 GLI AGENTI**
4. 📝 **Sintetizzo feedback** da tutti gli agenti
5. ✅ **Procedo con implementazione** basandomi su consenso

**Esempio Full-Stack**:
```
Feature: Gallery picker con OCR parallelo

Agenti Invocati (4 in parallelo):
1. backend-master-analyst → Review api_server.py OCR logic
2. general-purpose → Strategic choice (FIX 11 vs Alt A)
3. frontend-architect-prime → Review dashboard.js gallery picker
4. ui-design-master → UX assessment limite 10 foto
```

---

### 🔹 Dopo aver Implementato (Review Phase)

**Scenario**: Feature completata, pre-deploy review

1. ✅ **Completo implementazione**
2. 🤖 **INVOCO AGENTI IN PARALLELO** per review:
   - **Backend code** → `backend-master-analyst`
   - **Frontend code** → `frontend-architect-prime`
   - **UI/UX** → `ui-design-master`
   - **Strategy/Deploy** → `general-purpose`
3. 📋 **Identifico problemi** emersi dal review
4. 🔧 **Applico correzioni** se necessario
5. 📊 **Aggiorno documentazione**
6. 🚀 **Deploy solo se tutti approvano**

---

## Decision Matrix: Quali Agenti Invocare?

| Tipo Modifica | Backend Analyst | General-Purpose | Frontend Architect | UI Design Master |
|---------------|:---------------:|:---------------:|:------------------:|:----------------:|
| **API endpoint** | ✅ SEMPRE | ✅ SEMPRE | ❌ No | ❌ No |
| **Database schema** | ✅ SEMPRE | ✅ SEMPRE | ❌ No | ❌ No |
| **Celery tasks** | ✅ SEMPRE | ✅ (deploy) | ❌ No | ❌ No |
| **React component** | ❌ No | ❌ No | ✅ SEMPRE | ✅ SEMPRE |
| **JavaScript logic** | ❌ No | ❌ (strategy) | ✅ SEMPRE | ❌ No |
| **CSS/styling** | ❌ No | ❌ No | ⚠️ (se performance) | ✅ SEMPRE |
| **User flow** | ❌ No | ⚠️ (strategy) | ⚠️ (se code) | ✅ SEMPRE |
| **Full-stack feature** | ✅ SEMPRE | ✅ SEMPRE | ✅ SEMPRE | ✅ SEMPRE |
| **Deployment strategy** | ⚠️ (se infra) | ✅ SEMPRE | ❌ No | ❌ No |
| **Architecture decision** | ✅ SEMPRE | ✅ SEMPRE | ✅ (se frontend) | ⚠️ (UX impact) |

**Legenda**:
- ✅ SEMPRE = Invocazione obbligatoria
- ⚠️ = Invocazione consigliata (caso per caso)
- ❌ No = Non necessario

---

## Eccezioni

Posso procedere **SENZA** consultare gli agenti SOLO per:

- ✏️ Typo fixes (correzioni ortografiche)
- 📝 Log message updates (non-critical)
- 💬 Comment updates
- 📄 Documentation-only changes (README, markdown files)
- 🔥 Hotfix critici che bloccano production (ma review post-fix è OBBLIGATORIO entro 24h)

**IMPORTANTE**: Se in dubbio, SEMPRE invocare gli agenti. Meglio un'analisi in più che un bug in production.

---

## Template Invocazione Multi-Agent

### Scenario: Full-Stack Feature Implementation

```markdown
# Feature: [Nome Feature]

## Contesto Generale
[Descrizione problema, user story, requisiti]

## Modifiche Backend
**File**: api_server.py, tasks.py
**Cosa**: [Descrizione modifiche]

### Domande per Backend Master Analyst:
1. [Security concerns?]
2. [Performance bottlenecks?]
3. [Error handling robust?]

## Modifiche Frontend
**File**: dashboard.js, components/
**Cosa**: [Descrizione modifiche]

### Domande per Frontend Architect Prime:
1. [React best practices?]
2. [State management correct?]
3. [Memory leaks?]

## User Experience
**Flow**: [User journey steps]
**Error States**: [Come gestito?]

### Domande per UI Design Master:
1. [UX intuitive?]
2. [Error messages clear?]
3. [Accessibility compliant?]

## Strategia Deploy
**Risk**: [LOW/MEDIUM/HIGH]
**Rollback Plan**: [Descrizione]

### Domande per General-Purpose Agent:
1. [Approach corretto?]
2. [Technical debt acceptable?]
3. [Timeline realistic?]

---

## Output Richiesto (da tutti):
- ✅/⚠️/❌ Assessment
- Rating (se applicabile)
- Raccomandazioni prioritizzate
- Blockers per deploy (se presenti)
```

---

## Tracking Consultazioni

Ogni consultazione degli agenti viene documentata in:

📁 `STATO DEL PROGETTO SOCRATE/Log/AGENT_CONSULTATIONS_LOG.md`

**Formato Entry**:
```markdown
## [Data] - [Feature/Fix Name]

**Agenti Consultati**: [lista]
**Durata**: [tempo]

### Raccomandazioni Chiave:
- [Agent 1]: [sintesi]
- [Agent 2]: [sintesi]
- [...]

### Decisione Finale:
[Cosa è stato implementato e perché]

### Outcome:
[Success/Issues post-deploy]
```

---

## Esempi Reali

### ✅ Esempio 1: Alternative A Implementation (21 Oct 2025)

**Agenti Invocati**: 2 (backend-master-analyst, general-purpose)

**Risultato**:
- Backend Analyst: Rating 4.5/10 per FIX 11 → REJECT (Poppler blocker)
- General-Purpose: RECOMMEND Alternative A (zero debt, 2x faster)
- **Decisione**: Deploy Alternative A ✅
- **Outcome**: Success - no deployment issues

**Lesson Learned**: Consultare ENTRAMBI gli agenti ha prevenuto un deployment blocker (Poppler dependency)

---

### ✅ Esempio 2: Camera Batch Upload (Fixes 1-10)

**Agenti Invocati**: 4 (backend, strategy, UX, frontend)

**Risultato**:
- Consenso unanime su gallery picker approach
- UI Design Master identificò UX issues con camera behavior
- Frontend Architect ottimizzò Blob URLs (99% memory saving)
- **Decisione**: Remove camera, use gallery-only ✅
- **Outcome**: 100% device compatibility achieved

---

## Policy Compliance

**Questa policy è OBBLIGATORIA e NON può essere bypassata senza esplicita autorizzazione dell'utente.**

**Violations**:
- ❌ Deploy senza agent review → Rollback immediato
- ❌ Ignorare raccomandazioni critical → Blocco deployment
- ⚠️ Invocare solo 1 agente quando policy ne richiede 2+ → Warning + post-review obbligatoria

**Enforcement**:
- Pre-commit hook: Verifica che commit messages includano agent consultation (se file modificati richiedono review)
- Deploy checklist: "Agent review completed? YES/NO"

---

**Versione Policy**: 2.0
**Agenti Attivi**: 4 (backend, strategy, frontend, UX)
**Ultima Modifica**: 21 Ottobre 2025, ore 22:00
