<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard - Socrate AI</title>
    <link rel="stylesheet" href="/static/css/styles.css?v=FIX-DUPLICATE-20OCT2025">
    <link rel="stylesheet" href="/static/css/dashboard.css?v=FIX-DUPLICATE-20OCT2025">
    <link rel="icon" type="image/png" href="/static/images/CivettaLogo.png?v=FINAL-20251019">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
            <div class="dashboard-header-content">
                <!-- Logo Hero Section -->
                <a href="/" class="dashboard-logo-hero" style="display: flex; align-items: center; gap: 20px; text-decoration: none;">
                    <div style="position: relative;">
                        <img src="/static/images/socrate_logo.png" alt="Socrate AI Logo" style="height: 120px; width: auto; filter: drop-shadow(0 4px 20px rgba(6, 182, 212, 0.3));">
                    </div>
                    <div class="logo-text-container">
                        <div style="display: flex; align-items: baseline; gap: 8px;">
                            <span class="logo-brand">SOCRATE</span>
                            <span class="logo-ai">AI</span>
                        </div>
                        <span class="logo-tagline">Knowledge Assistant</span>
                    </div>
                </a>

                <!-- Actions Section -->
                <div class="dashboard-actions">
                    <button class="btn btn-tools" onclick="toggleToolsMenu()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 15l-3-3h6l-3 3zm0-6l3 3H9l3-3z"/>
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span>Strumenti</span>
                    </button>

                    <div class="dashboard-user">
                        <div class="user-info">
                            <img src="{{ user.photo_url or 'https://via.placeholder.com/40' }}"
                                 alt="{{ user.first_name }}"
                                 class="user-avatar">
                            <div>
                                <div class="user-name">{{ user.first_name }} {{ user.last_name or '' }}</div>
                                <span class="badge badge-gold">{{ user.subscription_tier }}</span>
                            </div>
                        </div>
                        <a href="/logout" class="btn btn-ghost btn-sm">Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Main Content -->
        <main class="dashboard-main">
            <!-- Welcome Message -->
            <div class="dashboard-welcome">
                <h1>Bentornato, {{ user.first_name }}!
                    <svg width="32" height="32" viewBox="0 0 64 64" style="display: inline-block; vertical-align: middle; margin-left: 8px;" aria-label="Saluto">
                        <g transform="translate(32, 32)">
                            <!-- Polso -->
                            <rect x="-6" y="10" width="12" height="8" rx="2" fill="url(#handGradient)" />

                            <!-- Palmo -->
                            <ellipse cx="0" cy="0" rx="12" ry="16" fill="url(#handGradient)" />

                            <!-- Pollice -->
                            <ellipse cx="-10" cy="4" rx="4" ry="10" fill="url(#handGradient)" transform="rotate(-30, -10, 4)" />

                            <!-- Dita (5 dita totali) -->
                            <ellipse cx="-6" cy="-12" rx="3" ry="12" fill="url(#handGradient)" />
                            <ellipse cx="-3" cy="-13" rx="2.8" ry="13" fill="url(#handGradient)" />
                            <ellipse cx="0" cy="-14" rx="3" ry="14" fill="url(#handGradient)" />
                            <ellipse cx="6" cy="-12" rx="3" ry="12" fill="url(#handGradient)" />
                            <ellipse cx="10" cy="-8" rx="2.5" ry="10" fill="url(#handGradient)" />

                            <!-- Glow effect -->
                            <ellipse cx="0" cy="0" rx="14" ry="18" fill="none" stroke="#D4AF37" stroke-width="0.5" opacity="0.3" />
                        </g>

                        <!-- Gradient definition -->
                        <defs>
                            <linearGradient id="handGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#D4AF37;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#C9A971;stop-opacity:1" />
                            </linearGradient>
                        </defs>

                        <!-- Animation (limited to 3 waves) -->
                        <animateTransform
                            attributeName="transform"
                            type="rotate"
                            from="0 32 32"
                            to="15 32 32"
                            dur="0.4s"
                            repeatCount="3"
                            direction="alternate"
                        />
                    </svg>
                </h1>
                <p>Gestisci i tuoi documenti, carica nuovi contenuti e interroga la tua knowledge base.</p>
            </div>

            <!-- Stats Row -->
            <div class="stats-row">
                <div class="stat-widget">
                    <div class="stat-widget-header">
                        <div class="stat-widget-icon">üìÅ</div>
                    </div>
                    <div class="stat-widget-value">{{ stats.documents.total }}</div>
                    <div class="stat-widget-label">Documenti Totali</div>
                </div>

                <div class="stat-widget stat-widget-bronze">
                    <div class="stat-widget-header">
                        <div class="stat-widget-icon">‚úÖ</div>
                    </div>
                    <div class="stat-widget-value">{{ stats.documents.ready }}</div>
                    <div class="stat-widget-label">Pronti</div>
                </div>

                <div class="stat-widget">
                    <div class="stat-widget-header">
                        <div class="stat-widget-icon">‚öôÔ∏è</div>
                    </div>
                    <div class="stat-widget-value">{{ stats.documents.processing }}</div>
                    <div class="stat-widget-label">In Elaborazione</div>
                </div>

                <div class="stat-widget stat-widget-bronze">
                    <div class="stat-widget-header">
                        <div class="stat-widget-icon">üí¨</div>
                    </div>
                    <div class="stat-widget-value">{{ stats.chat_sessions.total }}</div>
                    <div class="stat-widget-label">Chat Totali</div>
                </div>
            </div>

            <!-- Storage Info Card -->
            <div class="card card-glow" style="margin-bottom: var(--space-8);">
                <div class="card-header">
                    <h3 class="card-title">üíæ Spazio di Archiviazione</h3>
                    <p class="card-subtitle">
                        {{ user.storage_used_mb | round(2) }} MB / {{ user.storage_quota_mb }} MB utilizzati
                    </p>
                </div>
                <div class="upload-progress-bar">
                    <div class="upload-progress-fill"
                         style="width: {{ (user.storage_used_mb / user.storage_quota_mb * 100) | round }}%">
                    </div>
                </div>
            </div>

            <!-- Upload Section -->
            <section class="upload-section">
                <div class="section-header">
                    <h2 class="section-title">üì§ Carica Nuovo Documento</h2>
                </div>

                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Trascina un file qui o clicca per selezionare</div>
                    <div class="upload-hint">Supportati: PDF, DOCX, TXT, JPG, PNG, HEIC, WebP, TIFF (max {{ user.storage_quota_mb - user.storage_used_mb | round(2) }} MB disponibili)</div>
                    <input type="file" id="file-input" accept=".pdf,.docx,.txt,.jpg,.jpeg,.png,.heic,.heif,.webp,.bmp,.tiff" style="display: none;">
                    <!-- FIX 10: Gallery multi-select for universal compatibility (camera-input REMOVED) -->
                    <input type="file" id="gallery-input" accept="image/*" multiple style="display: none;">

                    <!-- Photo Capture Actions -->
                    <div class="camera-upload-actions">
                        <button type="button" class="btn-gallery-primary" id="gallery-btn" onclick="openGallery()" style="
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            padding: 12px 24px;
                            background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s, box-shadow 0.2s;
                            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
                        ">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span>üì∏ Seleziona Foto</span>
                        </button>
                        <div class="upload-hint" style="margin-top: 12px; font-size: 13px; color: #666; text-align: center; line-height: 1.5;">
                            üí° <strong>Consiglio:</strong> Scatta tutte le foto nella tua camera, poi selezionale qui (funziona su tutti i dispositivi)
                        </div>
                    </div>
                </div>

                <div id="upload-progress-container" class="upload-progress" style="display: none;">
                    <div class="upload-progress-bar">
                        <div class="upload-progress-fill" id="upload-progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="upload-progress-text" id="upload-progress-text">Caricamento...</div>
                </div>
            </section>

            <!-- Documents Section -->
            <section class="documents-section">
                <div class="section-header">
                    <h2 class="section-title">üìö I Miei Documenti</h2>
                </div>

                <div class="documents-controls">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text"
                               id="search-input"
                               placeholder="Cerca documenti per nome..."
                               aria-label="Cerca documenti">
                    </div>
                    <button class="btn btn-outline" onclick="loadDocuments()">
                        <span>üîÑ</span>
                        <span>Aggiorna</span>
                    </button>
                </div>

                <!-- Documents Grid -->
                <div id="documents-grid" class="documents-grid">
                    <!-- Populated by JavaScript -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">üì≠</div>
                    <h3 class="empty-state-title">Nessun documento caricato</h3>
                    <p class="empty-state-text">
                        Carica il tuo primo documento per iniziare a usare Socrate AI
                    </p>
                    <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                        <span>üì§</span>
                        <span>Carica Documento</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal" style="display: none;">
        <div class="modal-content" style="background: var(--color-bg-card); border: 1px solid var(--color-border-subtle); border-radius: var(--radius-lg); padding: var(--space-6); max-width: 500px;">
            <h2 style="color: var(--color-text-primary); margin-bottom: var(--space-4);">‚ö†Ô∏è Conferma Eliminazione</h2>
            <p style="color: var(--color-text-secondary); margin-bottom: var(--space-6);">
                Sei sicuro di voler eliminare questo documento? Questa azione non pu√≤ essere annullata.
            </p>
            <div style="display: flex; gap: var(--space-3);">
                <button class="btn btn-secondary" onclick="closeDeleteModal()" style="flex: 1;">Annulla</button>
                <button class="btn btn-primary" onclick="confirmDelete()" style="flex: 1; background: var(--color-error);">Elimina</button>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-preview-modal" class="modal" style="display: none;">
        <div class="modal-content" style="background: var(--color-bg-card); border: 1px solid var(--color-border-subtle); border-radius: var(--radius-lg); padding: var(--space-6); max-width: 600px;">
            <h2 style="color: var(--color-text-primary); margin-bottom: var(--space-4);">üì∏ Anteprima Foto</h2>

            <!-- Image Preview Container -->
            <div style="margin-bottom: var(--space-4); text-align: center;">
                <img id="preview-image" src="" alt="Preview" style="max-width: 100%; max-height: 400px; border-radius: var(--radius-md); border: 1px solid var(--color-border-subtle);">
            </div>

            <!-- Filename Input -->
            <div style="margin-bottom: var(--space-4);">
                <label for="preview-filename" style="display: block; color: var(--color-text-secondary); margin-bottom: var(--space-2); font-weight: 500;">
                    Nome File
                </label>
                <input
                    type="text"
                    id="preview-filename"
                    placeholder="documento-scansionato"
                    style="
                        width: 100%;
                        padding: var(--space-3);
                        background: var(--color-bg-primary);
                        border: 1px solid var(--color-border-subtle);
                        border-radius: var(--radius-md);
                        color: var(--color-text-primary);
                        font-size: 1rem;
                    "
                />
                <p style="color: var(--color-text-muted); font-size: 0.875rem; margin-top: var(--space-2);">
                    L'estensione .jpg verr√† aggiunta automaticamente
                </p>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: var(--space-3);">
                <button class="btn btn-secondary" onclick="closePreviewModal(); openCamera();" style="flex: 1;">
                    <span>üì∑</span>
                    <span>Scatta Altra Foto</span>
                </button>
                <button class="btn btn-primary" onclick="confirmUpload()" style="flex: 1;">
                    <span>‚úÖ</span>
                    <span>Carica Foto</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Rename Document Modal -->
    <div id="rename-modal" class="modal" style="display: none;">
        <div class="modal-content" style="background: var(--color-bg-card); border: 1px solid var(--color-border-subtle); border-radius: var(--radius-lg); padding: var(--space-6); max-width: 500px;">
            <h2 style="color: var(--color-text-primary); margin-bottom: var(--space-4);">‚úèÔ∏è Rinomina Documento</h2>

            <!-- New Filename Input -->
            <div style="margin-bottom: var(--space-6);">
                <label for="rename-input" style="display: block; color: var(--color-text-secondary); margin-bottom: var(--space-2); font-weight: 500;">
                    Nuovo Nome
                </label>
                <input
                    type="text"
                    id="rename-input"
                    placeholder="nome-documento"
                    style="
                        width: 100%;
                        padding: var(--space-3);
                        background: var(--color-bg-primary);
                        border: 1px solid var(--color-border-subtle);
                        border-radius: var(--radius-md);
                        color: var(--color-text-primary);
                        font-size: 1rem;
                    "
                />
                <p style="color: var(--color-text-muted); font-size: 0.875rem; margin-top: var(--space-2);">
                    L'estensione originale verr√† mantenuta
                </p>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: var(--space-3);">
                <button class="btn btn-secondary" onclick="closeRenameModal()" style="flex: 1;">Annulla</button>
                <button class="btn btn-primary" onclick="confirmRename()" style="flex: 1;">
                    <span>‚úÖ</span>
                    <span>Rinomina</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Eruda Mobile Console for Debug -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

    <!-- Dynamic script loading with runtime timestamp to bypass ALL caching -->
    <script>
        (function() {
            // Force fresh load with millisecond timestamp
            const timestamp = new Date().getTime();
            const script = document.createElement('script');
            script.src = '/static/js/dashboard.js?v={{ app_version }}&t=' + timestamp;
            script.async = false; // Load synchronously to ensure availability

            // Wait for script to load before initializing
            script.onload = function() {
                console.log('[CACHE-BUSTER] dashboard.js loaded successfully');
                // Initialize after dashboard.js is loaded
                if (typeof loadDocuments === 'function') {
                    loadDocuments();
                } else {
                    console.error('[INIT] loadDocuments not found in dashboard.js');
                }
                if (typeof setupUploadHandlers === 'function') {
                    setupUploadHandlers();
                } else {
                    console.error('[INIT] setupUploadHandlers not found in dashboard.js');
                }
            };

            document.head.appendChild(script);
            console.log('[CACHE-BUSTER] Loading dashboard.js with timestamp:', timestamp);
        })();
    </script>
    <script>
        let documentToDelete = null;

        // Setup drag & drop upload
        function setupUploadHandlers() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            // Click to upload
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // Drag & drop - FIX: Accept ALL file types (PDF, DOCX, TXT, images)
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                // Force copy cursor for all file types
                e.dataTransfer.dropEffect = 'copy';
                uploadArea.classList.add('dragging');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragging');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragging');

                const files = e.dataTransfer.files;
                console.log('[DRAG-DROP] Files dropped:', files.length, 'First file:', files[0]?.name, files[0]?.type);

                if (files.length > 0) {
                    // Validate file type against accepted extensions
                    const acceptedTypes = ['.pdf', '.docx', '.txt', '.jpg', '.jpeg', '.png', '.heic', '.heif', '.webp', '.bmp', '.tiff'];
                    const fileName = files[0].name.toLowerCase();
                    const isAccepted = acceptedTypes.some(ext => fileName.endsWith(ext));

                    if (!isAccepted) {
                        alert('‚ùå Tipo file non supportato.\n\nFormati accettati: PDF, DOCX, TXT, JPG, PNG, HEIC, WebP, TIFF');
                        console.error('[DRAG-DROP] Rejected file type:', fileName);
                        return;
                    }

                    console.log('[DRAG-DROP] File accepted, uploading:', fileName);
                    handleFileUpload(files[0]);
                }
            });

            // File input change (handles ONLY file-input, NOT camera-input or gallery-input)
            // Camera-input and gallery-input have their own listeners in dashboard.js
            fileInput.addEventListener('change', (e) => {
                console.log('[FILE-INPUT] Change event detected, target ID:', e.target.id);

                // IMPORTANT: Only handle file-input, ignore camera-input and gallery-input
                if (e.target !== fileInput) {
                    console.log('[FILE-INPUT] Ignoring event from non-file-input element:', e.target.id);
                    return;
                }

                // FIX 10.3: Extra safety - check target.id explicitly
                if (e.target.id !== 'file-input') {
                    console.log('[FILE-INPUT] Ignoring event from wrong input ID:', e.target.id);
                    return;
                }

                if (e.target.files.length > 0) {
                    console.log('[FILE-INPUT] Processing single file upload:', e.target.files[0].name);
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // Handle file upload
        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            const progressContainer = document.getElementById('upload-progress-container');
            const progressFill = document.getElementById('upload-progress-fill');
            const progressText = document.getElementById('upload-progress-text');

            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            progressText.textContent = 'Caricamento...';

            try {
                const xhr = new XMLHttpRequest();

                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressFill.style.width = percentComplete + '%';
                        progressText.textContent = `Caricamento: ${Math.round(percentComplete)}%`;
                    }
                });

                xhr.addEventListener('load', () => {
                    if (xhr.status === 200 || xhr.status === 201) {
                        progressText.textContent = '‚úÖ Caricamento completato! Il documento √® in elaborazione...';
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                            document.getElementById('file-input').value = '';
                            loadDocuments();
                        }, 2000);
                    } else {
                        progressText.textContent = '‚ùå Errore durante il caricamento';
                        console.error('Upload failed:', xhr.responseText);
                    }
                });

                xhr.addEventListener('error', () => {
                    progressText.textContent = '‚ùå Errore di rete';
                });

                xhr.open('POST', '/api/documents/upload');
                xhr.send(formData);

            } catch (error) {
                console.error('Upload error:', error);
                progressText.textContent = '‚ùå Errore durante il caricamento';
            }
        }

        // Delete modal functions
        function openDeleteModal(documentId) {
            documentToDelete = documentId;
            const modal = document.getElementById('delete-modal');
            modal.style.display = 'flex';
            modal.classList.add('active');  // Add active class for CSS animation
        }

        function closeDeleteModal() {
            documentToDelete = null;
            const modal = document.getElementById('delete-modal');
            modal.classList.remove('active');  // Remove active class
            modal.style.display = 'none';
        }

        async function confirmDelete() {
            if (!documentToDelete) return;

            try {
                const response = await fetch(`/api/documents/${documentToDelete}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    closeDeleteModal();
                    loadDocuments();
                } else {
                    alert('Errore durante l\'eliminazione del documento');
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('Errore durante l\'eliminazione del documento');
            }
        }

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const documentCards = document.querySelectorAll('.document-card');

            documentCards.forEach(card => {
                const title = card.querySelector('.document-title').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Tools menu placeholder (per futuro sviluppo)
        function toggleToolsMenu() {
            // TODO: Implementare menu strumenti con opzioni:
            // - Genera quiz
            // - Riassunto
            // - Mind map
            // - Outline
            // - Analisi avanzata
            alert('Menu Strumenti in arrivo! Include: Quiz, Riassunti, Mind Maps, Outline e molto altro.');
        }

        // ============================================================================
        // RENAME DOCUMENT FUNCTIONS (INLINE)
        // ============================================================================

        let documentToRename = null;

        function openRenameModal(documentId, currentFilename) {
            console.log('openRenameModal called:', documentId, currentFilename);
            documentToRename = documentId;

            const modal = document.getElementById('rename-modal');
            const input = document.getElementById('rename-input');

            // Extract filename without extension
            const lastDotIndex = currentFilename.lastIndexOf('.');
            const filenameWithoutExt = lastDotIndex > 0
                ? currentFilename.substring(0, lastDotIndex)
                : currentFilename;

            input.value = filenameWithoutExt;
            modal.style.display = 'flex';
            modal.classList.add('active');  // Add active class for CSS animation

            // Focus input and select all text
            setTimeout(() => {
                input.focus();
                input.select();
            }, 100);
        }

        function closeRenameModal() {
            console.log('closeRenameModal called');
            const modal = document.getElementById('rename-modal');
            modal.classList.remove('active');  // Remove active class
            modal.style.display = 'none';
            documentToRename = null;
            document.getElementById('rename-input').value = '';
        }

        async function confirmRename() {
            console.log('confirmRename called, documentToRename:', documentToRename);
            if (!documentToRename) return;

            const newName = document.getElementById('rename-input').value.trim();
            console.log('New name:', newName);

            if (!newName) {
                alert('Inserisci un nome valido');
                return;
            }

            try {
                const response = await fetch(`/api/documents/${documentToRename}/rename`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ new_filename: newName })
                });

                console.log('Rename response:', response.status);

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Rename failed');
                }

                closeRenameModal();
                await loadDocuments();
                alert('‚úÖ Documento rinominato');

            } catch (error) {
                console.error('Rename error:', error);
                alert('‚ùå Errore: ' + error.message);
            }
        }
    </script>
</body>
</html>
